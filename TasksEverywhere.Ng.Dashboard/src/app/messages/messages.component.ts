import { Component, OnInit } from '@angular/core';
import { ToastrService } from 'ngx-toastr';
import { SocketService, AuthenticationService } from '../services';
import { SocketMessage } from '../models/SocketMessage';

@Component({
  templateUrl: './messages.component.html',
  selector: 'app-messages',
})

export class MessagesComponent implements OnInit {
  model: any = {};
  loading = false;
  returnUrl: string;
  ioConnection: any;
  message: SocketMessage;
  options = {
    progressBar: true,
    positionClass: 'toast-bottom-full-width',
    timeOut: 10000
  };
  registration: ServiceWorkerRegistration;


  constructor(
    private socketService: SocketService,
    private toastr: ToastrService,
    private authenticationService: AuthenticationService) { }

  ngOnInit() {
    this.socketService.initSocket();

    if (!('Notification' in window)) {
      this.ChromNotifications();
    } else if (('serviceWorker' in navigator) && ('PushManager' in window)) {
      this.MozillaNotifications();
    }

    this.ioConnection = this.socketService.onMessage()
      .subscribe((message: any) => {
        const currentUser = this.authenticationService.currentUserValue();
        if (currentUser != null) {
          if (!message.Data.IsImportant) {
            this.toastr.info(this.GetBody(message), message.Title, this.options);
          } else {
            this.toastr.error(this.GetBody(message), message.Title, this.options);
          }
        }
      });
    }

    private GetBody(message: any) {
      if (message.DataType.indexOf('Branch') > 0) {
      return 'Nuovo branch per il repository' + message.Data.repository.full_name + 'da parte dell utente:' + message.Data.sender.username;
      } else if (message.DataType.indexOf('Push') > 0) {
      return 'Nuovo push per il repository ' + message.Data.repository.full_name + ' da parte dell utente: ' + message.Data.sender.username;
      } else if (message.DataType.indexOf('Call') > 0) {
        if (!message.Data.IsImportant) {
          return 'Fire Instance ID:' + message.Data.FireInstenceID;
        } else {
          return 'Fire Instance ID:' + message.Data.FireInstenceID + ' - messaggio di errore: ' + message.Data.Error.Message;
        }
    }
    return '';
  }

  private MozillaNotifications() {
    if (Notification.permission === 'granted') {
      this.socketService.onMessage()
      .subscribe((message: any) => {
        const currentUser = this.authenticationService.currentUserValue();
        if (currentUser != null) {
          const icon = message.Data.IsImportant ?
          'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQukqHPCZLfPsiAUbxcQmcJvbpHlusoMw33WwoCjGbXDw_fkxaQUw' :
          'data:image/png;base64,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';
          const n = new Notification(message.Title, { body: this.GetBody(message), icon : icon });
        }
      });
    } else if (Notification.permission !== 'denied') {
      Notification.requestPermission()
      .then(perm => {
        this.socketService.onMessage()
        .subscribe((message: any) => {
          const currentUser = this.authenticationService.currentUserValue();
          if (currentUser != null && perm === 'granted') {
            const icon = message.Data.IsImportant ?
            'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQukqHPCZLfPsiAUbxcQmcJvbpHlusoMw33WwoCjGbXDw_fkxaQUw' :
            'data:image/png;base64,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';
            const n = new Notification(message.Title, { body: this.GetBody(message), icon : icon });
          }
        });
      })
      .catch(err => console.error('Could not subscribe to notifications', err));
    }
  }

  private ChromNotifications() {
    if (Notification.permission === 'granted') {
      this.socketService.onMessage()
      .subscribe((message: any) => {
        const currentUser = this.authenticationService.currentUserValue();
        if (currentUser != null) {
          const icon = message.Data.IsImportant ?
          'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQukqHPCZLfPsiAUbxcQmcJvbpHlusoMw33WwoCjGbXDw_fkxaQUw' :
          'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAk1BMVEX///9fzspMpaI/oZ3A3Nv6/f1XqaZHo6BPysY3nppgz8tXzMhVzMdNpqPl9/b1+vpaw79z1NGWxsTx+/qy5uTG4uHE6+mF2NVXvbnV6eiIw8DT8fDR8O9isa7n9vaa393g7+6r5eOO29ig4d6n0c+02NdzubaLw8FTs7Cby8l8vLrP5uVrtLG/6+p51tNzu7mv0tEYO5vQAAARqklEQVR4nNWda4OiLBTHS1MaTR21y1pp1mRtdnn6/p/uAatJuSggVvt/t21j/AQOh8MBer1OZRiG5y7G69Vs5vfL8mez1Xq8cD34jW6L0JmMMEmW59XFGg5tqD4p9PFwaF1W52WShP8Wp5G4y/HGt0dUMpJ0ZPub8dJN/hHKcDFdb/whF1wZc+hv1tNF+O7iNylcrjeXviDdk7J/2ayXHwxpTH+gPZGj+6WENuhn+pnN1V35Viu4pyx/5b4bB5d3tiSbJl22bZ29d0M9FS5+LJV4d0jr50PsTrLcKK2+EqO9WSbvxuu509moG76CcTSbvrdHuuNZS9vZyNifjd/H6I0vHfPdGC/jNxmd8aUD+0JltC7jN/AtLq/Bu0NeFi/mc1cd2U8mov1SJyA8+6/lKxj988uGx+Vm9HI+pNFm+RI+d/0iA0PKttYvaKrL2Zvwbpp1XY3e2G8uRafyux0c3c27GuhT9qbDljp9Ww8sy7amHfF54/eYUFKjblpqsvqECrzJXnUwq1rMPgcQIs6Ue3HTd9tQXBfFnfGsKsikTtZZJeD63ThUrdUBvskPbdJoo4jP+CAjWpW9UhI6TlbvBqmRilHjExw1thS4cMnm3RAN2rSsxc/tgw+17Yuf3AcfWrUB/Og++JDdYtBYf+Y4iGskPfSf3110bkk6cNPP80VZkpsTLy7vLreAZELiiaKYGsqaGY2GQ9uvyh4OhyNGpo2EZsLDotd6ILznA21+1ufpIqTJnU7XP5t7TlHbX1uJBjbGbX/S34y5Fzfd6XjTdoZtCy5PTSXHCbtv+SgnRsZbdFGmkW/JLkmOhKyNK2NG7T6Ca7cqbbhn1G6lGq0l8MuesC9j29ZsNZaqOgrldLySSKyyN/xdUbAT2rfEO5UxTGiF1jNLMAeCvysuRXo9rL3V2e1gZc9IFuONWJDd51y2cQVGQtueLcPOFi6NMDxfhgKIM75usubnG63crpPsjMVFwK5z+eBLfjs6SzvGu0kgGm1xtNOQ147a/vhVSZLu5puT0N40d5kzZ5uwebu1CnmHP5yIo8aJlMvZIuzOl5srMgJeRL/J2HA63Lb/4gwe7lq0G8I2C85O+MomelMy50Wsf/ecqVyWmCPvuscsy4L5UwH89zFNRR4SxXyI9qXuKZzuGleM0jCM5LgNdrH+pSOBqorPvkC8C7Ij38aZDHAi1rx+jzNwcWnozV6SHrP9zvkquDQNMKUVrF/Obp9FSVjv2YZ7TsQL+zljzsG+znNAcMEJILaCTNdM83TK83wfVDTP89MpNp1H3eq6szsMorRmPJuYfIjsPuRy9kKfVQovmlznsXODg0WOd/vgmg0mEawffMuPF4ZpdBxk10OQn0xwA9Wd0x72T0aT9XKg8SDazDY25uJj2WPvuN2fHnTaab8dHGGNNE+pDC9Nj5Prfmfe+qpu5kEWUSEzR3O4apFRiS5ntsWI8oa8SZDH2o0O5IdJmgpuRjNg34228zulE+dbCmRialyINmOOMeXig82c5NvG5q2VfcWHo+fJ+quG50Xb3R3S3B2JL8BmyleL1JhNwlmF9g/+l+npZhfN+UCJL37cxzf7u8Ufl0FCjaMv2tTw6ZLX5cbdmTSGjdM5BZEKusczt9D6aGCAf6xrfIgjis/FPWsaYq/H2OkaiLfKM80y2DLMFPutG2EzIm0WxeuR9odY05l8wb6Bv2wVOpqavsU+uxNyIJLe6Q8v4QgjhL0f7LvIFfQCAE4MwkZzQ1oLjzt2YWOEjqbpjVVoJNDXmZQUJc27fge65jAImxEt/KWfucN2eCvVawmhD3cIdtA/i2OzLPjv02kXHKAHU0f4Rf4YJ6KNT/b5w084IWAQepPtPEZl+fWyKyp9GM+3E1ozryVs7It+9S9d/shrIyEct9NsbhYTC41Hhatg5lmE+QoNhA2IdtWvEVgtrCf00uiaI9+Li63CqUOP9Bqlz9psIqxHrLrPhkAcv55wCydO4nRPSnA68BPWI/rlvxVJSqgndOTx7pBP89lMWGtuKukLP/yADYRmS0BNMwUI6xFLQ2IokpXwUYS1iLOn5ya0nPZZhHV9sRTyXAsAfhxhDeJvPIl7WvGZhM43w04+Jxhi2U8fR8hG/M2U4g1ffCohG/E+XhhrocXyDyRkIdrr258nYrkln0jIQLTvSeC8S4afTMhAvC8mLkWyHRQTUmYfcoR0xGExIhqC+UHqCIGD5sU4pCQhFdEuUg3ERkN1hMDZX49RNNjuqoiyhDTE24iYCOY9KiIEp+z+oDRwlBDSEH1kahLBDDk1hOD0jNl723ItyhNSEG1EyBvrVkoIzEnpEd6+hNiCkEQsYt/8UTaVdVhdkjiW/qwNIYGIIm7CO5tUEIJD9RnJ/FmJrQhxRJRxYIhuOlBACHI8eHh9Fr0dIY54gYSiCc/tCcEpxQAVEmKIltHzxDwaBYTAJNfhFBJWEYdez305IWWhyjio6oc44tDlX1VTRagTK7tw0N+pJCwj2gvxrSMtCfWAskQxKHk1CghLiPa4Jzb9bU0IcsoKe3JSNOKTiPZaZMVChhDOHBznOX0AJ8pqf5gr8tooiPaqJ7xFTYgQxPvDdrvf3YP9VWftLiOolFsN4S/irFtC53CrsuR6a4dORgL2smqxFRE+EGc94T1jAoTO9fe7EWqJ+oGysj1xqiVTRXhH9HuigAKE4Fr6apoDsKOY0ShWNMdnIXZICHYVsxnFMc2M5higQsIbYoeE+Op+lJKAXkCEohQSFogdEsbNaWDegSyySkKE2B0hyCl1hmngkIVSSggR30p4NClr4moJNadDQnIWiCnFzWgXhFqXtpTiv5Rl5NTy/kuEh/p8PtKM/muEmpPWAW4ZJfqXCEEd4oBmZf41QojIbKfRiQH4bxHijttTKeGsdUfY5dyCOShWwvjdEpodz4A1jYp4qC2SSkJw6pyQhpjVpfcpJty1j9NUs6BJN4UcFqPaIsVlQr01Yd4+1rYDZcI5WT06hpiwxolbkeYlwhKuLOGhfbz0vwrhhFKGaojU29UBavozlAMJWbsR+Am37WPeB1BpiLTil2sx3NcXSf/9qrHVSxUqSahPJNYtsJ1vkV4J81LmtAgxvf932gAI+83zXQB8z4whThiJrz3hGxkMOIst7U9KqXnQIL8ekzA8XuubaFGi3yfF4AsLE0TChF+e+Pohsd8GGhc9ezbdjDJvh4havMvzuCkNXN8/H3TUgYmZ4YFwFrkpsQbcx/e7R1+VRV0jo2NQdpWQgPNnc0fbnvD9VIwJF1sgNiROKLUxQmQc9bT0AQOxWXp52cZzkJmoiumuMwnnhnguBrHF0oAuStXoZXL5e2Bf9tOhJcX99rB2JKWpMFWi+TTkXu70hFUiRJSoxSqgZ5K7ZCfCb65oBaI5UdhmlKISnbKVLxCp5qa+MBVAVIVEKKvOYWc8FD1CNK+NclQRCs2XfBEpRD2v7GuNHDyr6HbigJhAsZAgmpvYr2xGeTQfOBpUN5cLIpatKHpnOwBO+Oz5GAsCwpaFXptofmmfdvLHFvJUl3cNIUQccK4BMmXjINy57z1ZMEe4T7uWwEC7gbEVbIFBA+CAsNVjiWG0ZapG6bd2JZjn3X9miJeFELG1GH6LWl05TXKdyHzrNcyb6boXSDBXn16JhfOGIw6oYXtCDgY414FDAoY1sR2GHjMCwf0WrEr09hqBeORBBEQNAgffh98jV8M59JucJLZn5laJlKM1Qhpic0PFaxACmpS0KY8SPWh8dw9jJXHqs32hBELDgEyYOZ6a0nqzincNm6jm0I6gmAjzwdf9GMAkRkSUa0QKhUFxxIi+wvQohJZhfRBAQErGhifsdFfyr9bCgMRm8Hs5KINGWjPpxTOIECDFivZkxsIiRvOQ0B7ShyzKm6YOGuwAN8D8oGKYoBiZYg4qrtLrE9oH/FuJG27EA2NOjAWLESBlmOg1BSBZ7688+RLZy/3UmoZY9EUHm7peaSWszpZgc57ThwkpbwY9Pyg9Qu6SAIt6wZt3gDM7HHFAmFSAW8xoRx8mkI0WHwqhzLJjK3KmQgWRWotbBwATTxfCOiOIsTOlohMgoO/PkwMEceVhkqfo0xENONMA5rX6X2GlM+o5HidEZyZlVMC9FCAWWBE526Qq+pGvKHLjXDHu57o2IFZrJuiwN3ruhrg7en+J2DuUva2DcVroRIeMeEY3NEK3cyKJfLAJbNdEYO0mKSODZGIPEo64PTRkIEKfG5vWQkXz2DRPeBqtd9Up1IUYOTc8VUj8ivyVK/TjaNMT/BUyLSqdECRF+h49gapuNbxBZJIE91lfhPwpdehP54XTQv2/yvf20JGZUwGb1qlqVBkMbxJeZSsh0i8+TdBUg24fSzpCt9UJqCkbkuNgIdzO9OQmGA/RB42el0Grwij9XUYWQ+NDP7BPdpgoqpDYHdeTiH1XEOnlj9CJSpQzLH8h4CAJAP08SUO+iWrkigcS79mXVLFOJw5jdFAn1dnsFUEOQNvJVkh6mEBVuEtpj5QIZjw1ZJ3di1wZPaadKWsEX5B+Tz+yV36YKAjpR+TxnkHLqkWGSRns0CC/xQ8HDicxOjMzo9taudlEQxVynyPMQlwxDlBOD+go0ngblV5BOshR890zWmhN2huXWN2C9yxolliI3jFHB+fGweR23FxyvObITYsz1jtpB1iTf817njdLzBszk0Gso1Oed+hQ732ORgjd/M3PwBXtWlWgxrRs/Geys2TPmOeNp1msg+fh7LpzYJ3aTe4TEq7CGiej9V1k36x6QWdhzu+H6+vs9tmrSR7mJmRXYY/7bgSmrO/ajTLRNpjPD5M6L2cgE1WrAOK5cFW18E4fiE2OaK08mbgoRtiwCaL97bjfDZsQ6pTKz5Z+AfFUOFzii4kkIn0qxKFj3pavkoDGEO9dQXWI/zU0FIYGEmsTuIipPak2s6hfxLjWnDEUtDWiGmMzPC6BO7vYiM5ctDMmTVmLXMIj0XSt2xNafeq+9BpNFFTgb+5Fk0TuzmMifjvagf961zTgPDa6AZA1p8AltdhGIoIT9ZRuUh65qiEn/nbT2nlD+v4LnIAdwHjquFdSgU3uWvWlqrhT3fr+Cyf3h6btztEhVlOB9OgTS1J3yRKI/b8ogh+kNT+UBrGiCmza7ohL9j5gAlEDmrlntdXj3tRU8XFc0FCVkq5oWUXEEwCT0ljTrbrq0+hHF9Wq/b3cN/29/T74cvLsmHg3JehmAd57BfgEhF0MRXerWw/E4maAr/imL5mbBeoBeUfCsiQypeiI5dg87aYLFYAxz7BESC59oQGxEwFT8qKpswrCckPtTIy4crPWKsaM7hHJdGJ+qfBtEGOniOA/ecBeb6WEsFPExsBMvcR3RTHUmblpfZtWslECaPX/dIPIFbaol6umL3aEyHOQUXMtKuqLXSDi6Y2SUtYX/ygHFHdGGdooGRf71h+1/preapioaq2EECIq5ANai4Ge1FmJj6qyLwKzObotpKmSmYY6RCIDt70WrTI1nvpWggh2zQlzwkoUmVQViLr08latvLEak9oeUVd/c+1dU0tJfOq7HR9wlHfBp9S4cO0QlThqbHljBWsaxbqNLJ/ZWQt9aKkkBieLCGpSOZXJXavojd8yc2LgbNPuAaGWCvxUSwJRzyfdmZiqwrPfuhqF+yJ005RMlTjlruzWuUV9EUTASOfvUIu2CWIiiADEcgks7TS+tDQ5vIjAOclkryiQN770WzFCc9PMCLRT50MgW+541oqxORwOQP6iEYLJOJ2NWjA2IAJ9N3gvH1Ky3LSwq3WIAA6A7+dDChc/8jaHiag7QfS+/kfIO1uyFUlDRFnvrTJxO5G78uXCVTgiAGY8b7514B0ypj8zX8K2lpaJ0T6oXTD4uOp7KlyuN3CQFKS8L2oAHcT5tjbP/SMULqbrjT8UooSIQId0gyN7l8JHyUjc5Xjj2yMuTBt+z99sj1HyqrmRGhlhkizPq4s1hNVJJUUfD4fWZXVeJkn4b9E9ZRiG5y7G69VsVg3w+LPZaj1euB78RrdF+B909bmC+dCoFgAAAABJRU5ErkJggg==';
          this.registration.showNotification(message.Title, { body: this.GetBody(message), icon : icon });
          }
      });
    } else if (Notification.permission !== 'denied') {
      Notification.requestPermission()
      .then(perm => {
        this.socketService.onMessage()
        .subscribe((message: any) => {
          const currentUser = this.authenticationService.currentUserValue();
          if (currentUser != null && perm === 'granted') {
            const icon = message.Data.IsImportant ?
            'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQukqHPCZLfPsiAUbxcQmcJvbpHlusoMw33WwoCjGbXDw_fkxaQUw' :
            'data:image/png;base64,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';
            this.registration.showNotification(message.Title, { body: this.GetBody(message), icon : icon });
          }
        });
      })
      .catch(err => console.error('Could not subscribe to notifications', err));
    }
  }
}
